{"version":3,"names":["cov_9cq5fj6cs","actualCoverage","s","core_1","require","collection_enum_1","firestore_1","rxjs_1","auth_1","FirebaseService","constructor","ngFirebaseAuth","f","_users$","BehaviorSubject","users$","asObservable","db","getFirestore","saveUser","user","checkUser","uid","pipe","switchMap","isRegistered","b","defer","addDoc","collection","Collection","User","email","displayName","photoURL","emailVerified","isLoggedIn","updateUser","getUser","from","getDoc","doc","map","x","exists","updateDoc","onChangeUserCollection","query","onSnapshot","onChange","docs","forEach","j","next","getValue","data","tslib_1","__decorate","Injectable","providedIn","exports"],"sources":["C:\\Users\\User\\Desktop\\k6c6KIx4wbYIMnoNorW7\\src\\app\\services\\firebase.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Collection } from '@app/interfaces/collection.enum';\nimport { User } from '@app/interfaces/user.interface';\nimport {\n  collection,\n  addDoc,\n  getFirestore,\n  Firestore,\n  updateDoc,\n  doc,\n  onSnapshot,\n  getDoc,\n} from 'firebase/firestore';\nimport { BehaviorSubject, defer, from, map, switchMap } from 'rxjs';\nimport { AngularFireAuth } from '@angular/fire/compat/auth';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class FirebaseService {\n  private _users$ = new BehaviorSubject<User[]>([]);\n  private readonly db: Firestore;\n  readonly users$ = this._users$.asObservable();\n\n  constructor(private ngFirebaseAuth: AngularFireAuth) {\n    this.db = getFirestore();\n  }\n\n  saveUser(user: User) {\n    return this.checkUser(user.uid).pipe(\n      switchMap(isRegistered =>\n        !isRegistered\n          ? defer(() =>\n              addDoc(collection(this.db, Collection.User), {\n                uid: user.uid,\n                email: user.email,\n                displayName: user.displayName,\n                photoURL: user.photoURL,\n                emailVerified: user.emailVerified,\n                isLoggedIn: user.isLoggedIn,\n              })\n            )\n          : this.updateUser(user)\n      )\n    );\n  }\n\n  getUser() {\n    return this.ngFirebaseAuth.user;\n  }\n\n  checkUser(uid: string) {\n    return from(getDoc(doc(this.db, Collection.User, uid))).pipe(\n      map(x => x.exists())\n    );\n  }\n\n  updateUser(user: User) {\n    return from(\n      updateDoc(doc(this.db, Collection.User, user.uid), {\n        email: user.email,\n        displayName: user.displayName,\n        photoURL: user.photoURL,\n        emailVerified: user.emailVerified,\n        isLoggedIn: user.isLoggedIn,\n      })\n    );\n  }\n\n  onChangeUserCollection() {\n    const query = collection(this.db, Collection.User);\n    onSnapshot(query, onChange => {\n      onChange.docs.forEach(j => {\n        this._users$.next([...this._users$.getValue(), j.data() as User]);\n      });\n    });\n  }\n}\n"],"mappings":"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"}