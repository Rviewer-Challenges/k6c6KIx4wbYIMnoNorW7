{"version":3,"names":["cov_w5f0kn1a7","actualCoverage","s","core_1","require","auth_1","rxjs_1","firestore_1","user_interface_1","local_storage_service_1","AppComponent","constructor","firestore","auth","localStorageService","f","authState$","authState","ngOnInit","authStateSubscription","pipe","switchMap","aUser","b","save","StorageKeys","User","uid","combineLatest","from","getDoc","doc","Collections","Users","of","userDb","exists","updateDoc","isLoggedIn","setDoc","email","displayName","photoURL","emailVerified","userUid","get","tap","clear","EMPTY","subscribe","ngOnDestroy","unsubscribe","tslib_1","__decorate","Component","selector","template","exports"],"sources":["C:\\Users\\User\\Desktop\\k6c6KIx4wbYIMnoNorW7\\src\\app\\app.component.ts"],"sourcesContent":["import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { Auth, authState, User } from '@angular/fire/auth';\nimport {\n  combineLatest,\n  EMPTY,\n  from,\n  of,\n  Subscription,\n  switchMap,\n  tap,\n} from 'rxjs';\nimport {\n  Firestore,\n  getDoc,\n  setDoc,\n  updateDoc,\n  doc,\n} from '@angular/fire/firestore';\nimport { Collections, StorageKeys } from '@app/interfaces/user.interface';\nimport { LocalStorageService } from '@app/services/local-storage.service';\n\n@Component({\n  selector: 'app-root',\n  template: '<router-outlet></router-outlet>',\n})\nexport class AppComponent implements OnInit, OnDestroy {\n  authStateSubscription: Subscription;\n  authState$ = authState(this.auth);\n\n  constructor(\n    private firestore: Firestore,\n    private auth: Auth,\n    private localStorageService: LocalStorageService\n  ) {}\n\n  ngOnInit() {\n    this.authStateSubscription = this.authState$\n      .pipe(\n        switchMap((aUser: User | null) => {\n          if (aUser) {\n            this.localStorageService.save(StorageKeys.User, aUser.uid);\n            return combineLatest([\n              from(getDoc(doc(this.firestore, Collections.Users, aUser.uid))),\n              of(aUser),\n            ]).pipe(\n              switchMap(([userDb, aUser]) => {\n                if (userDb.exists()) {\n                  return updateDoc(\n                    doc(this.firestore, Collections.Users, aUser.uid),\n                    {\n                      isLoggedIn: true,\n                    }\n                  );\n                } else {\n                  return from(\n                    setDoc(doc(this.firestore, Collections.Users, aUser.uid), {\n                      email: aUser.email,\n                      displayName: aUser.displayName,\n                      photoURL: aUser.photoURL,\n                      emailVerified: aUser.email,\n                      isLoggedIn: true,\n                    })\n                  );\n                }\n              })\n            );\n          } else {\n            const userUid = this.localStorageService.get(StorageKeys.User);\n            if (userUid) {\n              return from(\n                updateDoc(doc(this.firestore, Collections.Users, userUid), {\n                  isLoggedIn: false,\n                })\n              ).pipe(tap(() => this.localStorageService.clear()));\n            } else {\n              return EMPTY;\n            }\n          }\n        })\n      )\n      .subscribe();\n  }\n\n  ngOnDestroy() {\n    this.authStateSubscription.unsubscribe();\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA2BE;IAAAA,aAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,aAAA;AAAAA,aAAA,GAAAE,CAAA;;;;;;;;;;AA3BF,MAAAC,MAAA;AAAA;AAAA,CAAAH,aAAA,GAAAE,CAAA,OAAAE,OAAA;AACA,MAAAC,MAAA;AAAA;AAAA,CAAAL,aAAA,GAAAE,CAAA,OAAAE,OAAA;AACA,MAAAE,MAAA;AAAA;AAAA,CAAAN,aAAA,GAAAE,CAAA,OAAAE,OAAA;AASA,MAAAG,WAAA;AAAA;AAAA,CAAAP,aAAA,GAAAE,CAAA,OAAAE,OAAA;AAOA,MAAAI,gBAAA;AAAA;AAAA,CAAAR,aAAA,GAAAE,CAAA,OAAAE,OAAA;AACA,MAAAK,uBAAA;AAAA;AAAA,CAAAT,aAAA,GAAAE,CAAA,OAAAE,OAAA;AAA0E;AAAAJ,aAAA,GAAAE,CAAA;AAM1E,IAAaQ,YAAY,GAAzB,MAAaA,YAAY;EAIvBC,YACUC,SAAoB,EACpBC,IAAU,EACVC,mBAAwC;IAAA;IAAAd,aAAA,GAAAe,CAAA;IAAAf,aAAA,GAAAE,CAAA;IAFxC,KAAAU,SAAS,GAATA,SAAS;IAAW;IAAAZ,aAAA,GAAAE,CAAA;IACpB,KAAAW,IAAI,GAAJA,IAAI;IAAM;IAAAb,aAAA,GAAAE,CAAA;IACV,KAAAY,mBAAmB,GAAnBA,mBAAmB;IAAqB;IAAAd,aAAA,GAAAE,CAAA;IALlD,KAAAc,UAAU,GAAG,IAAAX,MAAA,CAAAY,SAAS,EAAC,IAAI,CAACJ,IAAI,CAAC;EAM9B;EAEHK,QAAQA,CAAA;IAAA;IAAAlB,aAAA,GAAAe,CAAA;IAAAf,aAAA,GAAAE,CAAA;IACN,IAAI,CAACiB,qBAAqB,GAAG,IAAI,CAACH,UAAU,CACzCI,IAAI,CACH,IAAAd,MAAA,CAAAe,SAAS,EAAEC,KAAkB,IAAI;MAAA;MAAAtB,aAAA,GAAAe,CAAA;MAAAf,aAAA,GAAAE,CAAA;MAC/B,IAAIoB,KAAK,EAAE;QAAA;QAAAtB,aAAA,GAAAuB,CAAA;QAAAvB,aAAA,GAAAE,CAAA;QACT,IAAI,CAACY,mBAAmB,CAACU,IAAI,CAAChB,gBAAA,CAAAiB,WAAW,CAACC,IAAI,EAAEJ,KAAK,CAACK,GAAG,CAAC;QAAC;QAAA3B,aAAA,GAAAE,CAAA;QAC3D,OAAO,IAAAI,MAAA,CAAAsB,aAAa,EAAC,CACnB,IAAAtB,MAAA,CAAAuB,IAAI,EAAC,IAAAtB,WAAA,CAAAuB,MAAM,EAAC,IAAAvB,WAAA,CAAAwB,GAAG,EAAC,IAAI,CAACnB,SAAS,EAAEJ,gBAAA,CAAAwB,WAAW,CAACC,KAAK,EAAEX,KAAK,CAACK,GAAG,CAAC,CAAC,CAAC,EAC/D,IAAArB,MAAA,CAAA4B,EAAE,EAACZ,KAAK,CAAC,CACV,CAAC,CAACF,IAAI,CACL,IAAAd,MAAA,CAAAe,SAAS,EAAC,CAAC,CAACc,MAAM,EAAEb,KAAK,CAAC,KAAI;UAAA;UAAAtB,aAAA,GAAAe,CAAA;UAAAf,aAAA,GAAAE,CAAA;UAC5B,IAAIiC,MAAM,CAACC,MAAM,EAAE,EAAE;YAAA;YAAApC,aAAA,GAAAuB,CAAA;YAAAvB,aAAA,GAAAE,CAAA;YACnB,OAAO,IAAAK,WAAA,CAAA8B,SAAS,EACd,IAAA9B,WAAA,CAAAwB,GAAG,EAAC,IAAI,CAACnB,SAAS,EAAEJ,gBAAA,CAAAwB,WAAW,CAACC,KAAK,EAAEX,KAAK,CAACK,GAAG,CAAC,EACjD;cACEW,UAAU,EAAE;aACb,CACF;WACF,MAAM;YAAA;YAAAtC,aAAA,GAAAuB,CAAA;YAAAvB,aAAA,GAAAE,CAAA;YACL,OAAO,IAAAI,MAAA,CAAAuB,IAAI,EACT,IAAAtB,WAAA,CAAAgC,MAAM,EAAC,IAAAhC,WAAA,CAAAwB,GAAG,EAAC,IAAI,CAACnB,SAAS,EAAEJ,gBAAA,CAAAwB,WAAW,CAACC,KAAK,EAAEX,KAAK,CAACK,GAAG,CAAC,EAAE;cACxDa,KAAK,EAAElB,KAAK,CAACkB,KAAK;cAClBC,WAAW,EAAEnB,KAAK,CAACmB,WAAW;cAC9BC,QAAQ,EAAEpB,KAAK,CAACoB,QAAQ;cACxBC,aAAa,EAAErB,KAAK,CAACkB,KAAK;cAC1BF,UAAU,EAAE;aACb,CAAC,CACH;;QAEL,CAAC,CAAC,CACH;OACF,MAAM;QAAA;QAAAtC,aAAA,GAAAuB,CAAA;QACL,MAAMqB,OAAO;QAAA;QAAA,CAAA5C,aAAA,GAAAE,CAAA,QAAG,IAAI,CAACY,mBAAmB,CAAC+B,GAAG,CAACrC,gBAAA,CAAAiB,WAAW,CAACC,IAAI,CAAC;QAAC;QAAA1B,aAAA,GAAAE,CAAA;QAC/D,IAAI0C,OAAO,EAAE;UAAA;UAAA5C,aAAA,GAAAuB,CAAA;UAAAvB,aAAA,GAAAE,CAAA;UACX,OAAO,IAAAI,MAAA,CAAAuB,IAAI,EACT,IAAAtB,WAAA,CAAA8B,SAAS,EAAC,IAAA9B,WAAA,CAAAwB,GAAG,EAAC,IAAI,CAACnB,SAAS,EAAEJ,gBAAA,CAAAwB,WAAW,CAACC,KAAK,EAAEW,OAAO,CAAC,EAAE;YACzDN,UAAU,EAAE;WACb,CAAC,CACH,CAAClB,IAAI,CAAC,IAAAd,MAAA,CAAAwC,GAAG,EAAC,MAAM;YAAA;YAAA9C,aAAA,GAAAe,CAAA;YAAAf,aAAA,GAAAE,CAAA;YAAA,WAAI,CAACY,mBAAmB,CAACiC,KAAK,EAAE;UAAF,CAAE,CAAC,CAAC;SACpD,MAAM;UAAA;UAAA/C,aAAA,GAAAuB,CAAA;UAAAvB,aAAA,GAAAE,CAAA;UACL,OAAOI,MAAA,CAAA0C,KAAK;;;IAGlB,CAAC,CAAC,CACH,CACAC,SAAS,EAAE;EAChB;EAEAC,WAAWA,CAAA;IAAA;IAAAlD,aAAA,GAAAe,CAAA;IAAAf,aAAA,GAAAE,CAAA;IACT,IAAI,CAACiB,qBAAqB,CAACgC,WAAW,EAAE;EAC1C;;;;;;;;;;;;;;;;;;;;AA5DWzC,YAAY,GAAA0C,OAAA,CAAAC,UAAA,EAJxB,IAAAlD,MAAA,CAAAmD,SAAS,EAAC;EACTC,QAAQ,EAAE,UAAU;EACpBC,QAAQ,EAAE;CACX,CAAC,C,EACW9C,YAAY,CA6DxB;AAAA;AAAAV,aAAA,GAAAE,CAAA;AA7DYuD,OAAA,CAAA/C,YAAA,GAAAA,YAAA"}